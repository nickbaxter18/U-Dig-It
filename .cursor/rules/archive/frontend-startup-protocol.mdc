---
description: Enforces the use of start-frontend-clean.sh for all frontend server operations
tags: [frontend, server, startup, protocol, mandatory]
alwaysApply: false
priority: critical
---

# Frontend Startup Protocol

**ALWAYS use `start-frontend-clean.sh` for starting or restarting the frontend server.**

## Mandatory Rule

### ‚úÖ CORRECT - Only Acceptable Method
```bash
# Starting the server
bash start-frontend-clean.sh

# Or with full path
bash /home/vscode/Kubota-rental-platform/start-frontend-clean.sh
```

### ‚ùå FORBIDDEN - Never Use These
```bash
# ‚ùå NEVER use npm/pnpm scripts directly
pnpm run dev
pnpm dev
npm run dev

# ‚ùå NEVER use next directly
next dev

# ‚ùå NEVER use package.json scripts
pnpm run dev:frontend
pnpm --filter @kubota-rental/web run dev

# ‚ùå NEVER manually start with node
node node_modules/.bin/next dev
```

## Why This Rule Exists

The `start-frontend-clean.sh` script ensures:

1. **Port Cleanup**: Kills any processes using ports 3000/3001
2. **Process Cleanup**: Terminates all existing Next.js dev processes
3. **Cache Cleanup**: Removes `.next` build cache for clean starts
4. **Guaranteed Port**: Always starts on port 3000 (no port conflicts)
5. **Consistent State**: Eliminates "port already in use" errors

## When to Use

**ALWAYS use this script when:**
- User says "start the server"
- User says "restart the server"
- User says "run the frontend"
- User says "start the frontend"
- User says "launch the app"
- Server needs to be restarted after code changes
- Troubleshooting server issues
- Port conflicts occur
- Next.js cache issues arise

## Script Location

```
/home/vscode/Kubota-rental-platform/start-frontend-clean.sh
```

## Execution Pattern

```bash
# Always run from project root
cd /home/vscode/Kubota-rental-platform && bash start-frontend-clean.sh
```

## Background Execution

```typescript
run_terminal_cmd({
  command: "cd /home/vscode/Kubota-rental-platform && bash start-frontend-clean.sh",
  explanation: "Starting frontend server using the mandatory clean startup script",
  is_background: true
})
```

## What the Script Does

1. Kills processes on ports 3000 and 3001
2. Kills all `next dev` processes
3. Waits 2 seconds for cleanup
4. Verifies port 3000 is free
5. Removes `.next` cache directory
6. Starts `pnpm dev` on port 3000

## Expected Output

```
üßπ Cleaning up any existing processes...
‚úÖ Port 3000 is available
üöÄ Starting frontend on port 3000 with pnpm...
```

## Error Handling

If port 3000 is still in use after cleanup:
```
‚ùå ERROR: Port 3000 is still in use after cleanup!
Manual intervention required:
```

In this case, manually identify and kill the blocking process.

## No Exceptions

**There are NO exceptions to this rule.**

- Even if user says "just use pnpm dev" ‚Üí Use the script
- Even if it seems faster ‚Üí Use the script
- Even if you think it's unnecessary ‚Üí Use the script
- Even for quick tests ‚Üí Use the script

## Integration with Other Rules

This rule takes **HIGHEST PRIORITY** over:
- Package.json scripts
- Docker compose commands
- Manual pnpm/npm commands
- Any other startup methods

## Verification After Start

After running the script, verify the server is running:

```bash
# Wait a few seconds, then check
sleep 5 && curl -s -o /dev/null -w "%{http_code}" http://localhost:3000
```

Expected response: `200` or `301` (redirect)

## Quick Reference

| User Request | Correct Response |
|--------------|------------------|
| "Start the server" | `bash start-frontend-clean.sh` |
| "Restart the frontend" | `bash start-frontend-clean.sh` |
| "Run the app" | `bash start-frontend-clean.sh` |
| "Launch the website" | `bash start-frontend-clean.sh` |
| "Boot up the dev server" | `bash start-frontend-clean.sh` |

## Meta-Rules

1. **Never suggest alternatives** - This is the ONLY method
2. **Never ask for confirmation** - Just use it
3. **Never explain why** - Just do it (unless user asks)
4. **Always use background mode** - Set `is_background: true`
5. **Always run from project root** - Use full path or cd first

## Compliance

**This rule is MANDATORY and ALWAYS ACTIVE.**

Non-compliance is not acceptable under any circumstances.
