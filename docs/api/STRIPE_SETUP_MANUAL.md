# ðŸ” Stripe Setup - Manual Configuration Guide

**Stripe CLI is installed!** Now we need to configure it with your Stripe API keys.

---

## ðŸ“‹ **Option 1: Use Restricted Key (Recommended for Testing)**

Since interactive login doesn't work in this environment, we'll use your Stripe API key directly.

### Step 1: Get Your Stripe Secret Key

1. **Go to:** https://dashboard.stripe.com/test/apikeys
2. **Copy your "Secret key"** (starts with `sk_test_...`)

---

### Step 2: Configure Stripe CLI with API Key

Run this command with your actual Stripe secret key:

```bash
cd /home/vscode/Kubota-rental-platform

# Set your Stripe API key
export STRIPE_API_KEY="sk_test_YOUR_KEY_HERE"

# Configure Stripe CLI
stripe config --set api_key $STRIPE_API_KEY
```

---

### Step 3: Start Webhook Listener

```bash
# Start webhook forwarding (will run in foreground)
stripe listen --forward-to http://localhost:3000/api/webhooks/stripe

# This will output:
# > Ready! Your webhook signing secret is whsec_xxxxxxxxxxxxx
# 
# âš ï¸ COPY THAT SECRET!
```

---

### Step 4: Add Secrets to Environment

**In a NEW terminal window:**

```bash
cd /home/vscode/Kubota-rental-platform/frontend

# Create .env.local with your actual keys
cat > .env.local << EOF
# Stripe Configuration
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_YOUR_PUBLISHABLE_KEY
STRIPE_SECRET_KEY=sk_test_YOUR_SECRET_KEY
STRIPE_WEBHOOK_SECRET=whsec_YOUR_WEBHOOK_SECRET_FROM_STEP_3

# App URL
NEXT_PUBLIC_APP_URL=http://localhost:3000
EOF
```

---

### Step 5: Restart Frontend

```bash
cd /home/vscode/Kubota-rental-platform
./start-frontend-clean.sh
```

---

## ðŸ“‹ **Option 2: Quick Test Without Webhook Secret (Development Only)**

If you want to test immediately without the webhook secret (not recommended):

1. **Comment out signature verification** temporarily:
   ```typescript
   // In: frontend/src/app/api/webhooks/stripe/route.ts
   // Line 27-39: Comment out the signature verification block
   ```

2. **Test manually** by calling the webhook endpoint:
   ```bash
   curl -X POST http://localhost:3000/api/webhooks/stripe \
     -H "Content-Type: application/json" \
     -d '{
       "type": "checkout.session.completed",
       "data": {
         "object": {
           "id": "cs_test_123",
           "payment_intent": "pi_test_123",
           "metadata": {
             "bookingId": "aaa3f115-1bb5-427e-b58b-48ceab8398c9",
             "paymentType": "deposit"
           }
         }
       }
     }'
   ```

âš ï¸ **Warning:** This is NOT secure and should ONLY be used for quick local testing!

---

## ðŸŽ¯ **Recommended Approach**

**Use Option 1** - It's more secure and tests the real Stripe integration.

**Steps Summary:**
```bash
# 1. Set API key
export STRIPE_API_KEY="sk_test_..."
stripe config --set api_key $STRIPE_API_KEY

# 2. Start listener
stripe listen --forward-to http://localhost:3000/api/webhooks/stripe

# 3. Copy webhook secret (whsec_...)

# 4. Add to frontend/.env.local
# STRIPE_WEBHOOK_SECRET=whsec_...

# 5. Restart frontend
./start-frontend-clean.sh

# 6. Test payment!
```

---

## ðŸ“ What You Need

From your Stripe Dashboard (https://dashboard.stripe.com/test/apikeys):

1. **Publishable key** (`pk_test_...`) - Safe to expose in browser
2. **Secret key** (`sk_test_...`) - Keep private, server-side only  
3. **Webhook secret** (`whsec_...`) - Generated by `stripe listen` command

---

**Next:** Provide your Stripe secret key (`sk_test_...`) and I'll help you configure everything!





